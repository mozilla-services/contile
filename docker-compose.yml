version: "3"
services:
  partner:
    image: mozilla/contile-integration-tests-partner
    container_name: partner
    environment:
      PORT: 5000
      RESPONSES_FILE: /tmp/partner/responses.yml
    expose:
      - "5000"
    volumes:
      - ./tools/volumes/partner:/tmp/partner
  contile:
    image: app:build
    container_name: contile
    depends_on:
      - partner
    links:
      - partner
    environment:
      CONTILE_ADM_ENDPOINT_URL: http://partner:5000/tilesp
      CONTILE_ADM_QUERY_TILE_COUNT: 2
      CONTILE_ADM_SETTINGS: /tmp/contile/adm_settings.json
      # Timeout requests to the ADM server after this many seconds (default: 5)
      CONTILE_ADM_TIMEOUT: 2
      CONTILE_DEBUG: 1
      CONTILE_HOST: 0.0.0.0
      CONTILE_HUMAN_LOGS: 1
      CONTILE_PORT: 8000
      RUST_LOG: main,contile=INFO
    expose:
      - "8000"
    volumes:
      - ./tools/volumes/contile:/tmp/contile
  client:
    image: mozilla/contile-integration-tests-client
    container_name: client
    depends_on:
      - partner
      - contile
    links:
      - contile
    environment:
      CONTILE_URL: http://contile:8000
      SCENARIOS_FILE: /tmp/client/scenarios.yml
    volumes:
      - ./tools/volumes/client:/tmp/client
    command: >
      "-vv"